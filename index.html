<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lua Obfuscator</title>
    <style>
      /* Animations */
      @keyframes popup {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes idle-logo {
        0% {
          transform: rotate(4deg) scale(1);
        }
        100% {
          transform: rotate(-4deg) scale(1.02);
        }
      }

      /* Base CSS */
      :root {
        --primary-color: rgb(255, 143, 16);
        --background-color: #2a2a2e;
        --card-bg-color: rgba(40, 40, 40, 0.7);
        --text-color: #f0f0f0;
        --border-color: rgba(255, 255, 255, 0.1);
        --shadow-color: #1a1a1a;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        outline: none;
        border: none;
        text-decoration: none;
      }

      body {
        display: flex;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--text-color);
        height: 100vh;
        background: linear-gradient(
          135deg,
          #3a3a3e 0%,
          var(--background-color) 100%
        );
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      /* Navbar */
      .navbar {
        display: flex;
        height: 5rem;
        width: 100%;
        justify-content: space-between;
        align-items: center;
        padding: 1.4rem 5%;
        background-color: rgba(51, 51, 51, 0.4);
        border-bottom: 2px solid var(--border-color);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        animation: popup 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards;
      }

      .logo {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-color);
        transition: color 0.3s ease;
        animation: idle-logo 4s ease-in-out infinite alternate;
      }
      .logo span {
        color: var(--primary-color);
        transition: color 0.3s ease;
      }
      .logo:hover {
        color: var(--primary-color);
      }
      .logo:hover span {
        color: var(--text-color);
      }

      /* Profile Icon */
      .profile {
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        background-image: url("https://i.pravatar.cc/150?u=xeerazz"); /* Placeholder image */
        background-size: cover;
        background-position: center;
        box-shadow: 0 0 15px var(--shadow-color);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 2px solid transparent;
      }
      .profile:hover {
        border-color: var(--primary-color);
        transform: scale(1.15) rotate(10deg);
      }
      .profile:active {
        transform: scale(1.05);
      }

      /* Main Form Card */
      form {
        width: clamp(350px, 60%, 700px);
        animation: popup 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) 200ms
          backwards;
      }

      .card {
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        overflow: hidden;
      }

      .card-header {
        padding: 1.5rem;
        text-align: center;
        border-bottom: 1px solid var(--border-color);
        background: rgba(0, 0, 0, 0.2);
      }
      .card-header h3 {
        font-size: 1.8rem;
        color: var(--text-color);
        transition: color 0.3s ease;
      }
      .card-header h3:hover {
        color: var(--primary-color);
      }

      .card-body {
        padding: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .form-group h4 {
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: #ccc;
      }

      /* File Upload Area */
      .filescript-area {
        text-align: center;
      }

      .upload-button {
        display: inline-block;
        background-color: transparent;
        color: var(--text-color);
        padding: 12px 25px;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }
      .upload-button:hover {
        background-color: var(--primary-color);
        box-shadow: 0 0 20px rgba(255, 143, 16, 0.5);
        transform: translateY(-3px);
      }

      #file-info {
        margin-top: 1rem;
        color: #aaa;
        font-size: 0.9rem;
        min-height: 1.2rem;
      }
      #file-info.highlight {
        color: var(--primary-color);
        font-weight: 500;
      }

      /* Key Input Box */
      .inputBox {
        position: relative;
      }

      .inputBox input {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        background: rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        font-size: 1em;
        color: var(--text-color);
        transition: 0.3s ease;
      }

      .inputBox .key-label {
        position: absolute;
        left: 0;
        top: 0;
        padding: 12px;
        font-size: 1em;
        color: rgba(255, 255, 255, 0.5);
        pointer-events: none;
        transition: 0.3s ease;
      }

      .inputBox input:valid ~ .key-label,
      .inputBox input:focus ~ .key-label {
        color: var(--primary-color);
        transform: translateX(10px) translateY(-9px);
        font-size: 0.75em;
        padding: 0 10px;
        background: var(--background-color);
        border-left: 1px solid var(--primary-color);
        border-right: 1px solid var(--primary-color);
      }

      .inputBox input:valid,
      .inputBox input:focus {
        border-color: var(--primary-color);
      }

      .inputBox #key-counter {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.8em;
        color: rgba(255, 255, 255, 0.4);
      }

      /* Submit Button */
      .submit-button {
        align-self: center;
        margin-top: 1rem;
        background: var(--primary-color);
        color: #fff;
        font-weight: bold;
        font-size: 1.2em;
        padding: 15px 35px;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        z-index: 1;
        box-shadow: 0 4px 15px rgba(255, 143, 16, 0.3);
      }
      .submit-button:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
        z-index: -1;
      }
      .submit-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(255, 143, 16, 0.5);
      }
      .submit-button:hover:before {
        width: 250px;
        height: 250px;
      }
      .submit-button:active {
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>

    <form id="form" onsubmit="return false;">
      <div class="card">
        <div class="card-header">
          <h3>Lua Obfuscator</h3>
        </div>
        <div class="card-body">
          <div class="form-group filescript-area">
            <h4>Upload Your Script</h4>
            <input type="file" id="file" accept=".lua,.txt" hidden />
            <button
              type="button"
              class="upload-button"
              id="upload-btn"
              aria-label="Select a Lua or text file to upload"
            >
              Select File
            </button>
            <p id="file-info">No file chosen</p>
          </div>

          <div class="form-group">
            <h4>Set Encryption Key</h4>
            <div class="inputBox">
              <input
                type="text"
                id="key"
                maxlength="20"
                required
                aria-labelledby="key-label-span"
              />
              <span class="key-label" id="key-label-span">Encryption Key</span>
              <small id="key-counter">0/20</small>
            </div>
          </div>

          <button
            type="submit"
            class="submit-button"
            id="obfuscate-btn"
            aria-label="Obfuscate the selected script and download the result"
          >
            Obfuscate and Download
          </button>
        </div>
      </div>
    </form>

    <script>
      // --- ELEMENT SELECTORS ---
      const form = document.getElementById("form");
      const fileInput = document.getElementById("file");
      const uploadBtn = document.getElementById("upload-btn");
      const fileInfo = document.getElementById("file-info");
      const keyInput = document.getElementById("key");
      const keyCounter = document.getElementById("key-counter");
      const obfuscateBtn = document.getElementById("obfuscate-btn");

      // --- OBFUSCATION LOGIC (UNCHANGED) ---
      let realKey = "";
      const leng = 128;
      const abc = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
      const abcTab = abc.split("");

      const createRandomString = () => {
        let str = "";
        for (let i = 0; i < leng; i++) {
          str += abcTab[Math.floor(Math.random() * abcTab.length)];
        }
        return str;
      };

      const ran1 = createRandomString();
      const ran2 = createRandomString();
      const ran3 = createRandomString();
      const ran4 = createRandomString();
      const ran5 = createRandomString();
      const ran6 = createRandomString();

      const xorE = (sc, key) => {
        const tabel = [];
        let k = 0;
        for (let i = 0; i < sc.length; i++) {
          let byteValue = sc.charCodeAt(i) + key.charCodeAt(k);
          tabel.push(byteValue);
          k = (k + 1) % key.length;
        }
        return tabel;
      };

      const createRandomByteTable = () => {
        const tab = [];
        for (let i = 0; i < leng; i++) {
          tab[i] =
            abcTab[Math.floor(Math.random() * abcTab.length)].charCodeAt(0);
        }
        return tab.join();
      };

      const tab1 = createRandomByteTable();
      const tab2 = createRandomByteTable();
      const tab3 = createRandomByteTable();
      const tab4 = createRandomByteTable();
      const tab5 = createRandomByteTable();
      const tab6 = createRandomByteTable();

      const alibi = (var1, var2, var3, tablenya) => {
        return `_ENV={string=string,table=table,math=math,pairs=pairs,load=load,print=print};${var1}="${var2}";${var2}="${var1}";${var3}={${tablenya}};function xor(t)local ciphertext="";for i=1,#${var2} do local byte=string.byte(${var2}, i);local quibit=string.byte(${var1},(i-1)%#${var1}+1);ciphertext=ciphertext..string.char(bit.bxor(byte,quibit));end;return ciphertext;end;bit={bxor=function(a,b)local r,m=0,1;while a>0 and b>0 do local aa,bb=a%2,b%2;r=r+m*((aa+bb)%2);m=m*2;a=math.floor(a/2);b=math.floor(b/2) end;if a>0 then r=r+m*a end;if b>0 then r=r+m*b end;return r;end};xor(${var3})${ran1}z="Encrypt By Yasu";`;
      };

      const decX = (tabel) => {
        const [script, keyleng, l, v, hasil] = [ran3, ran4, ran1, ran2, ran5];
        return `${script}={${tabel.join()}};${keyleng}=0;${hasil}='';for ${l},${v} in pairs(${script}) do ${keyleng}=${keyleng}+1;${hasil}=${hasil}.._ENV["\\115\\116\\114\\105\\110\\103"]["\\99\\104\\97\\114"](${v}-_ENV["\\115\\116\\114\\105\\110\\103"]["\\98\\121\\116\\101"]("${realKey}",${keyleng}));if ${keyleng}==#"${realKey}" then ${keyleng}=0;end;end;if ${ran1}z=="\\69\\110\\99\\114\\121\\112\\116\\32\\66\\121\\32\\89\\97\\115\\117" then _ENV["\\108\\111\\97\\100"](${hasil})() else print("Error while running this code");end;`;
      };

      // --- EVENT LISTENERS & UI LOGIC ---

      // Trigger file input from custom button
      uploadBtn.addEventListener("click", () => {
        fileInput.click();
      });

      // Update file info display on file selection
      fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const fileName = file.name;
          const fileSize = (file.size / 1024).toFixed(2);
          if (fileName.endsWith(".lua") || fileName.endsWith(".txt")) {
            fileInfo.innerHTML = `Selected: <strong>${fileName}</strong> (${fileSize} KB)`;
            fileInfo.classList.add("highlight");
          } else {
            fileInfo.textContent = "Error: Only .lua or .txt files are allowed!";
            fileInfo.classList.remove("highlight");
            fileInput.value = ""; // Clear the invalid file
          }
        } else {
          fileInfo.textContent = "No file chosen";
          fileInfo.classList.remove("highlight");
        }
      });

      // Update key character counter
      keyInput.addEventListener("input", () => {
        keyCounter.textContent = `${keyInput.value.length}/20`;
      });

      // Handle form submission
      form.addEventListener("submit", (event) => {
        event.preventDefault(); // Prevent default form submission

        const file = fileInput.files[0];
        const keys = keyInput.value;

        if (!file) {
          alert("Please select a file first!");
          return;
        }

        obfuscateBtn.textContent = "Processing...";
        obfuscateBtn.disabled = true;

        // Convert key to escaped string format for Lua
        realKey = "";
        for (let i = 0; i < keys.length; i++) {
          realKey += "\\" + keys.charCodeAt(i);
        }

        const reader = new FileReader();
        reader.readAsText(file);

        reader.onload = () => {
          const sc = reader.result;

          const templateE = `local key=[[${keys}]];${ran1}z="Encrypt By Yasu";${ran2}=${ran1};${ran3}=${ran2};${ran4}=${ran3};${ran5}=${ran4};${ran6}=${ran5};`;
          const alibiChain =
            alibi(ran1, ran2, ran3, tab1) +
            alibi(ran4, ran2, ran5, tab2) +
            alibi(ran6, ran3, ran1, tab3) +
            alibi(ran2, ran4, ran6, tab4) +
            alibi(ran1, ran4, ran5, tab5) +
            alibi(ran2, ran1, ran3, tab6);

          const finalScript =
            templateE + alibiChain + decX(xorE(sc, keys));

          const blob = new Blob([finalScript], { type: "text/plain" });
          const href = URL.createObjectURL(blob);

          // Create filename, ensuring it ends with .lua
          let originalName = file.name;
          let baseName = originalName.includes(".")
            ? originalName.substring(0, originalName.lastIndexOf("."))
            : originalName;
          const downloadName = `Encrypted_${baseName}.lua`;

          const a = Object.assign(document.createElement("a"), {
            href,
            style: "display:none",
            download: downloadName,
          });

          document.body.appendChild(a);
          a.click();

          // Cleanup and reset
          URL.revokeObjectURL(href);
          a.remove();
          
          setTimeout(() => {
            form.reset();
            fileInfo.textContent = "No file chosen";
            fileInfo.classList.remove("highlight");
            keyCounter.textContent = "0/20";
            obfuscateBtn.textContent = "Obfuscate and Download";
            obfuscateBtn.disabled = false;
          }, 500); // Small delay for better UX
        };

        reader.onerror = () => {
            alert("Error reading the file. Please try again.");
            obfuscateBtn.textContent = "Obfuscate and Download";
            obfuscateBtn.disabled = false;
        };
      });
    </script>
  </body>
</html>